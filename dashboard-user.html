<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SORTIQ - Dashboard</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Alpine.js Logic -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('appData', () => ({
                currentPage: 'home',
                pageTitle: 'Ringkasan Dashboard',
                xp: 1250,
                username: 'User',
                showPaymentModal: false,
                selectedItem: null,
                paymentStep: 1, 
                
                navItems: [
                    { id: 'home', label: 'Dashboard', icon: 'ph-bold ph-squares-four' },
                    { id: 'tpa', label: 'Peta TPA', icon: 'ph-bold ph-map-trifold' },
                    { id: 'bot', label: 'Tanya AI', icon: 'ph-bold ph-robot' },
                    { id: 'market', label: 'Eco Market', icon: 'ph-bold ph-storefront' },
                    { id: 'calc', label: 'Jejak Karbon', icon: 'ph-bold ph-calculator' },
                ],

                selectedTpaId: 3,
                tpaSearch: '',
                tpaData: [
                    { id: 1, nama: "TPA Benowo", alamat: "Jl. Romokalisari, Kec. Benowo, Surabaya", lat: -7.210452, lng: 112.632231, status: "Beroperasi", kapasitas: "85%", tipe: "Sanitary Landfill", jarak: "5.2 km", zoom: 16 },
                    { id: 2, nama: "TPA Jabon", alamat: "Kec. Jabon, Kabupaten Sidoarjo", lat: -7.534211, lng: 112.748532, status: "Beroperasi", kapasitas: "60%", tipe: "Controlled Landfill", jarak: "12.8 km", zoom: 15 },
                    { id: 3, nama: "TPA Griyo Mulyo", alamat: "Kec. Jabon, Sidoarjo (Fasilitas Baru)", lat: -7.531522, lng: 112.751244, status: "Rekomendasi Utama", kapasitas: "40%", tipe: "Waste to Energy", jarak: "13.0 km", zoom: 17 }
                ],

                get selectedTpa() { return this.tpaData.find(t => t.id === this.selectedTpaId); },
                get filteredTpa() { return this.tpaData.filter(t => t.nama.toLowerCase().includes(this.tpaSearch.toLowerCase())); },

                stats: [
                    { label: 'Total Sampah', value: '14.5 Kg', icon: 'ph-bold ph-trash', colorBg: 'bg-emerald-50', colorText: 'text-emerald-600' },
                    { label: 'Emisi Dicegah', value: '5.2 Kg', icon: 'ph-bold ph-leaf', colorBg: 'bg-blue-50', colorText: 'text-blue-600' },
                    { label: 'Peringkat', value: '#15', icon: 'ph-bold ph-trophy', colorBg: 'bg-purple-50', colorText: 'text-purple-600' },
                    { label: 'Streak', value: '3 Hari', icon: 'ph-bold ph-fire', colorBg: 'bg-orange-50', colorText: 'text-orange-600' }
                ],

                activities: [
                    { id: 1, title: 'Menyetor Botol Plastik', date: 'Hari ini, 10:23', xp: 50, emoji: 'ðŸ¥¤' },
                    { id: 2, title: 'Menyetor Kardus Bekas', date: 'Kemarin, 16:40', xp: 120, emoji: 'ðŸ“¦' },
                    { id: 3, title: 'Tukar Voucher Listrik', date: '2 Hari lalu', xp: 0, emoji: 'âš¡' },
                    { id: 4, title: 'Menyetor Kaleng', date: '3 Hari lalu', xp: 80, emoji: 'ðŸ¥«' }
                ],

                marketItems: [
                    { id: 1, name: 'Voucher Gopay 10k', desc: 'Saldo E-Wallet instan.', cost: '1000 XP', type: 'xp', priceValue: 1000, bgClass: 'bg-blue-50 text-blue-500', icon: 'ph-duotone ph-wallet' },
                    { id: 2, name: 'Bibit Mangga', desc: 'Hijaukan pekaranganmu.', cost: '500 XP', type: 'xp', priceValue: 500, bgClass: 'bg-green-50 text-green-600', icon: 'ph-duotone ph-plant' },
                    { id: 3, name: 'Starter Kit Kompos', desc: 'Alat komposting rumah.', cost: 'Rp 150.000', type: 'money', priceValue: 150000, bgClass: 'bg-orange-50 text-orange-500', icon: 'ph-duotone ph-recycle' },
                    { id: 4, name: 'Totebag Kanvas', desc: 'Pengganti kresek.', cost: 'Rp 25.000', type: 'money', priceValue: 25000, bgClass: 'bg-purple-50 text-purple-500', icon: 'ph-duotone ph-bag' }
                ],

                chatInput: '',
                isTyping: false,
                chatMessages: [],
                carbonCalc: { plastic: 2, paper: 1, glass: 0.5, metal: 0.2 },
                
                get weeklyEmission() {
                    const ePlastic = this.carbonCalc.plastic * 6.0;
                    const ePaper = this.carbonCalc.paper * 1.5;
                    const eGlass = this.carbonCalc.glass * 0.9;
                    const eMetal = this.carbonCalc.metal * 4.0;
                    return (ePlastic + ePaper + eGlass + eMetal).toFixed(2);
                },
                get treesNeeded() {
                    return Math.ceil((this.weeklyEmission * 52) / 22);
                },

                calc: { plastic: 5, paper: 2 }, 
                toast: { show: false, title: '', message: '' },
                get totalCarbon() { return ((parseFloat(this.calc.plastic || 0) * 6) + (parseFloat(this.calc.paper || 0) * 1.5)).toFixed(1); },
                get totalTrees() { return Math.ceil(this.totalCarbon / 20); },

                init() {
                    const storedName = localStorage.getItem('sortiq_username');
                    if (storedName) this.username = storedName;
                    const storedXP = localStorage.getItem('sortiq_xp');
                    if (storedXP) this.xp = parseInt(storedXP);
                    else localStorage.setItem('sortiq_xp', this.xp);
                    this.chatMessages = [{ id: 1, text: `Halo ${this.username}! Saya AI SORTIQ. Ada yang bisa saya bantu?`, sender: 'bot', time: '10:00' }];
                    this.$nextTick(() => { this.initChart(); });
                },

                setPage(pageId) {
                    this.currentPage = pageId;
                    const titles = { 'home': `Halo, ${this.username}!`, 'tpa': 'Peta & Lokasi TPA', 'bot': 'Asisten AI Pintar', 'market': 'Eco Market & Shop', 'calc': 'Kalkulator Dampak' };
                    this.pageTitle = titles[pageId] || 'Dashboard';
                    const scrollArea = document.getElementById('main-scroll');
                    if(scrollArea) scrollArea.scrollTop = 0;
                },

                selectTpa(id) { this.selectedTpaId = id; },
                openGmaps() { const tpa = this.selectedTpa; window.open(`https://www.google.com/maps/dir/?api=1&destination=${tpa.lat},${tpa.lng}`, '_blank'); },

                sendMessage() {
                    if (!this.chatInput.trim()) return;
                    this.chatMessages.push({ id: Date.now(), text: this.chatInput, sender: 'user', time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
                    const userText = this.chatInput; this.chatInput = ''; this.isTyping = true;
                    setTimeout(() => {
                        this.isTyping = false;
                        let reply = "Maaf, saya masih belajar.";
                        if(userText.toLowerCase().includes('botol')) reply = "Botol plastik PET sangat berharga! Pastikan sudah kosong.";
                        this.chatMessages.push({ id: Date.now() + 1, text: reply, sender: 'bot', time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
                    }, 1500);
                },
                
                startTransaction(item) {
                    this.selectedItem = item;
                    if (item.type === 'xp') {
                        if (this.xp >= item.priceValue) {
                            this.xp -= item.priceValue;
                            localStorage.setItem('sortiq_xp', this.xp);
                            this.showToast('Penukaran Berhasil!', `Kamu mendapatkan ${item.name}`);
                        } else {
                            this.showToast('Gagal', 'Poin XP tidak mencukupi.', true);
                        }
                    } else {
                        this.paymentStep = 1;
                        this.showPaymentModal = true;
                    }
                },

                processPayment() {
                    this.paymentStep = 2;
                    setTimeout(() => { this.paymentStep = 3; }, 3000);
                },

                closePayment() {
                    this.showPaymentModal = false;
                    this.selectedItem = null;
                    this.paymentStep = 1;
                },

                showToast(title, message, isError = false) {
                    this.toast.title = title;
                    this.toast.message = message;
                    this.toast.show = true;
                    setTimeout(() => { this.toast.show = false }, 3000);
                },

                initChart() {
                    const el = document.getElementById('recycleChart');
                    if (!el) return;
                    const existingChart = Chart.getChart(el);
                    if (existingChart) existingChart.destroy();
                    new Chart(el.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'],
                            datasets: [{ label: 'Sampah (kg)', data: [2.5, 3.2, 1.8, 4.5, 2.0, 5.5, 3.8], borderColor: '#10B981', backgroundColor: 'rgba(16, 185, 129, 0.1)', borderWidth: 3, tension: 0.4, fill: true }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
                    });
                }
            }));
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    animation: { 'float': 'float 6s ease-in-out infinite', 'slide-up': 'slideUp 0.5s ease-out forwards' },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 10px; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.6); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans overflow-hidden" x-data="appData">

    <!-- BACKGROUND BLOBS -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-emerald-400/20 rounded-full blur-[100px] animate-float"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-blue-400/20 rounded-full blur-[100px] animate-float" style="animation-delay: 2s;"></div>
    </div>

    <div class="flex h-screen w-full">
        <!-- === SIDEBAR (DESKTOP) === -->
        <aside class="hidden md:flex flex-col w-72 bg-white border-r border-slate-200 h-full z-30 shadow-sm">
            <div class="p-8 flex items-center gap-3">
                <!-- LOGO SIDEBAR (Updated) -->
                <img src="logo.png" 
                     onerror="this.src='https://placehold.co/40x40/10b981/ffffff?text=S'" 
                     alt="Logo" class="w-10 h-10 object-contain shadow-sm">
                <div>
                    <h1 class="font-bold text-xl tracking-tight text-slate-900 leading-none">SORTIQ</h1>
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">Smart Recycle</p>
                </div>
            </div>

            <nav class="flex-1 px-4 space-y-1 overflow-y-auto no-scrollbar">
                <p class="px-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 mt-4">Navigasi Utama</p>
                
                <template x-for="item in navItems" :key="item.id">
                    <button @click="setPage(item.id)" 
                            :class="currentPage === item.id ? 'bg-emerald-50 text-emerald-600 border-emerald-100 shadow-sm' : 'text-slate-500 hover:bg-slate-50 border-transparent'"
                            class="w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl font-semibold text-sm transition-all duration-200 border group relative">
                        <i :class="item.icon" class="text-xl transition-transform group-hover:scale-110"></i>
                        <span x-text="item.label"></span>
                        <div x-show="currentPage === item.id" class="absolute right-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-emerald-500 rounded-l-full"></div>
                    </button>
                </template>

                <p class="px-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 mt-6">Fitur Pintar</p>
                <button onclick="window.location.href='scan.html'"
                        class="text-slate-500 hover:bg-emerald-50 hover:text-emerald-600 w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl font-semibold text-sm transition-all duration-200 border border-transparent group">
                    <i class="ph-bold ph-scan text-xl transition-transform group-hover:scale-110"></i>
                    <span>AI Scanner</span>
                    <span class="ml-auto bg-emerald-100 text-emerald-600 text-[10px] px-2 py-0.5 rounded-full">New</span>
                </button>
            </nav>

            <div class="p-4 border-t border-slate-100">
                <a href="beranda.html" class="flex items-center gap-3 text-red-500 font-bold text-sm hover:bg-red-50 p-4 rounded-2xl transition group">
                    <i class="ph-bold ph-sign-out text-xl group-hover:-translate-x-1 transition"></i> Keluar Akun
                </a>
            </div>
        </aside>

        <!-- === MAIN CONTENT === -->
        <main class="flex-1 flex flex-col h-full relative overflow-hidden">
            <header class="flex justify-between items-center px-6 py-4 md:px-10 md:py-6 z-20 glass sticky top-0">
                <div class="flex items-center gap-3 md:hidden">
                    <!-- LOGO HEADER MOBILE (Updated) -->
                    <img src="logo.png" 
                         onerror="this.src='https://placehold.co/32x32/10b981/ffffff?text=S'" 
                         alt="Logo" class="w-8 h-8 object-contain">
                    <span class="font-bold text-lg tracking-tight">SORTIQ</span>
                </div>
                <div class="hidden md:block">
                    <h2 class="text-2xl font-bold text-slate-800 tracking-tight" x-text="pageTitle"></h2>
                    <p class="text-slate-500 text-sm">Mari buat dunia lebih bersih bersama SORTIQ.</p>
                </div>
                <!-- PROFILE USER (TETAP AVATAR/BUKAN LOGO BRAND) -->
                <div class="flex items-center gap-3">
                    <div class="bg-white pl-1 pr-3 py-1 rounded-full border border-slate-200 shadow-sm flex items-center gap-2">
                        <div class="w-7 h-7 bg-yellow-100 rounded-full flex items-center justify-center text-yellow-600">
                            <i class="ph-fill ph-coin text-sm"></i>
                        </div>
                        <span class="font-bold text-sm text-slate-700" x-text="xp + ' XP'"></span>
                    </div>
                    <!-- Ini adalah Profil User, tetap menggunakan Avatar -->
                    <img src="https://ui-avatars.com/api/?name=User&background=10b981&color=fff" class="w-10 h-10 rounded-full border-2 border-white shadow-sm hidden sm:block">
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-4 md:p-10 pb-32 md:pb-10 scroll-smooth no-scrollbar" id="main-scroll">
                
                <!-- === HOME VIEW === -->
                <div x-show="currentPage === 'home'" x-transition class="space-y-8 max-w-6xl mx-auto animate-slide-up">
                    <div class="bg-slate-900 rounded-[2.5rem] p-6 md:p-10 text-white relative overflow-hidden shadow-2xl group">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-emerald-500 rounded-full blur-[100px] opacity-20 group-hover:opacity-30 transition duration-700"></div>
                        <div class="relative z-10 md:w-2/3">
                            <div class="inline-flex items-center gap-2 px-3 py-1 bg-white/10 backdrop-blur-md rounded-full text-[10px] font-bold mb-4 text-emerald-300 border border-white/10 uppercase tracking-widest">âœ¨ Tantangan Harian</div>
                            <h2 class="text-3xl md:text-5xl font-extrabold mb-4 leading-tight tracking-tight">Sudahkah Kamu<br>Memilah Hari Ini?</h2>
                            <p class="text-slate-300 mb-8 max-w-md text-sm md:text-base leading-relaxed">Dapatkan 100 XP tambahan dengan menyetorkan sampah plastik hari ini.</p>
                            <div class="flex flex-wrap gap-4">
                                <button onclick="window.location.href='scan.html'" class="bg-emerald-500 hover:bg-emerald-400 text-white px-8 py-3.5 rounded-2xl font-bold shadow-lg shadow-emerald-500/30 transition active:scale-95 flex items-center gap-3">
                                    <i class="ph-bold ph-camera text-xl"></i> Mulai Scan
                                </button>
                                <button @click="setPage('tpa')" class="bg-white/10 hover:bg-white/20 text-white px-8 py-3.5 rounded-2xl font-bold backdrop-blur-md transition flex items-center gap-3">
                                    <i class="ph-bold ph-map-pin text-xl"></i> Cari TPA
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <template x-for="(stat, index) in stats" :key="index">
                            <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition duration-300">
                                <div :class="`w-12 h-12 ${stat.colorBg} ${stat.colorText} rounded-2xl flex items-center justify-center mb-4 text-2xl shadow-sm`"><i :class="stat.icon"></i></div>
                                <p class="text-slate-400 text-[10px] font-bold uppercase tracking-wider" x-text="stat.label"></p>
                                <p class="font-extrabold text-2xl text-slate-800 mt-1" x-text="stat.value"></p>
                            </div>
                        </template>
                    </div>

                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-100 shadow-sm">
                            <h3 class="font-bold text-lg text-slate-800 mb-6 flex items-center gap-2">
                                <i class="ph-bold ph-chart-line-up text-emerald-500"></i> Aktivitas Mingguan
                            </h3>
                            <div class="h-64 w-full"><canvas id="recycleChart"></canvas></div>
                        </div>
                        <div class="bg-white p-6 md:p-8 rounded-[2.5rem] border border-slate-100 shadow-sm flex flex-col h-full overflow-hidden">
                            <h3 class="font-bold text-lg text-slate-800 mb-6">Aktivitas Terbaru</h3>
                            <div class="space-y-6 overflow-y-auto flex-1 no-scrollbar">
                                <template x-for="activity in activities" :key="activity.id">
                                    <div class="flex items-center gap-4 group">
                                        <div class="w-12 h-12 bg-slate-50 rounded-2xl flex items-center justify-center text-xl shadow-sm group-hover:bg-emerald-50 transition" x-text="activity.emoji"></div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-800 text-sm" x-text="activity.title"></h4>
                                            <p class="text-[10px] text-slate-400 font-medium" x-text="activity.date"></p>
                                        </div>
                                        <span class="text-emerald-600 font-bold text-xs bg-emerald-50 px-2.5 py-1 rounded-full" x-text="'+' + activity.xp + ' XP'"></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- === TPA VIEW === -->
                <div x-show="currentPage === 'tpa'" x-transition class="h-full flex flex-col md:flex-row gap-6 max-w-7xl mx-auto animate-slide-up">
                    <!-- ... (Isi Peta Sama Seperti Sebelumnya) ... -->
                    <div class="w-full md:w-80 flex flex-col gap-4">
                        <div class="bg-white p-4 rounded-3xl border border-slate-200 shadow-sm">
                            <div class="relative">
                                <i class="ph-bold ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input type="text" x-model="tpaSearch" placeholder="Cari nama TPA..." class="w-full pl-10 pr-4 py-3 bg-slate-50 rounded-2xl text-sm outline-none focus:ring-2 focus:ring-emerald-500/20 border border-transparent focus:border-emerald-500 transition-all">
                            </div>
                        </div>
                        <div class="flex-1 overflow-y-auto space-y-3 no-scrollbar pb-10">
                            <template x-for="tpa in filteredTpa" :key="tpa.id">
                                <button @click="selectTpa(tpa.id)" 
                                        :class="selectedTpaId === tpa.id ? 'border-emerald-500 bg-white ring-4 ring-emerald-500/10 shadow-lg' : 'border-white bg-white/50 hover:bg-white'"
                                        class="w-full text-left p-5 rounded-[2rem] border-2 transition-all duration-300 group">
                                    <div class="flex justify-between items-start mb-2">
                                        <span :class="selectedTpaId === tpa.id ? 'text-emerald-700' : 'text-slate-800'" class="font-bold text-base leading-tight" x-text="tpa.nama"></span>
                                        <div :class="selectedTpaId === tpa.id ? 'bg-emerald-500 scale-125' : 'bg-slate-200'" class="w-2 h-2 rounded-full transition-all"></div>
                                    </div>
                                    <p class="text-[10px] text-slate-400 font-medium mb-4 line-clamp-1" x-text="tpa.alamat"></p>
                                    <div class="flex items-center justify-between">
                                        <div class="flex gap-2">
                                            <span class="text-[9px] bg-slate-100 text-slate-600 px-2 py-1 rounded-lg font-bold uppercase" x-text="tpa.jarak"></span>
                                            <span class="text-[9px] bg-emerald-50 text-emerald-700 px-2 py-1 rounded-lg font-bold uppercase" x-text="tpa.tipe"></span>
                                        </div>
                                        <i class="ph-bold ph-arrow-right text-emerald-500 opacity-0 group-hover:opacity-100 transition-all"></i>
                                    </div>
                                </button>
                            </template>
                        </div>
                    </div>

                    <div class="flex-1 flex flex-col bg-white rounded-[3rem] border border-slate-200 shadow-xl overflow-hidden min-h-[500px]">
                        <div class="flex-1 relative">
                            <div class="absolute top-6 left-6 z-10 bg-white/90 backdrop-blur-md px-4 py-2 rounded-full shadow-lg border border-white flex items-center gap-2">
                                <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
                                <span class="text-[10px] font-black uppercase tracking-widest text-slate-700">Tampilan Satelit Live</span>
                            </div>
                            <iframe 
                                :src="`https://maps.google.com/maps?q=${selectedTpa.lat},${selectedTpa.lng}&t=k&z=${selectedTpa.zoom}&ie=UTF8&iwloc=&output=embed`"
                                width="100%" height="100%" frameborder="0" class="filter contrast-[1.1] brightness-[0.95]">
                            </iframe>
                        </div>
                        <div class="p-8 bg-white border-t border-slate-100">
                            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-2">
                                        <h3 class="text-2xl font-black text-slate-800 tracking-tighter" x-text="selectedTpa.nama"></h3>
                                        <span :class="selectedTpa.id === 3 ? 'bg-amber-100 text-amber-600' : 'bg-emerald-100 text-emerald-600'" 
                                              class="px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest" x-text="selectedTpa.status"></span>
                                    </div>
                                    <p class="text-slate-500 text-sm font-medium flex items-center gap-2">
                                        <i class="ph-bold ph-map-pin text-emerald-500"></i>
                                        <span x-text="selectedTpa.alamat"></span>
                                    </p>
                                </div>
                                <div class="flex items-center gap-4 w-full lg:w-auto">
                                    <button @click="openGmaps()" class="flex-1 lg:flex-none bg-emerald-600 hover:bg-emerald-700 text-white px-10 py-4 rounded-2xl font-bold flex items-center justify-center gap-3 shadow-xl shadow-emerald-200 transition active:scale-95">
                                        <i class="ph-bold ph-navigation-arrow text-xl"></i> NAVIGASI
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- === CHAT BOT VIEW === -->
                <div x-show="currentPage === 'bot'" x-transition class="h-[calc(100vh-180px)] flex flex-col bg-white rounded-[2.5rem] border border-slate-200 shadow-lg overflow-hidden max-w-4xl mx-auto animate-slide-up">
                    <div class="p-6 bg-white border-b border-slate-100 flex items-center gap-4">
                        <div class="w-12 h-12 bg-emerald-600 rounded-2xl flex items-center justify-center text-white shadow-lg"><i class="ph-bold ph-robot text-2xl"></i></div>
                        <div>
                            <h3 class="font-bold text-slate-800 text-lg">SORTIQ Assistant</h3>
                            <p class="text-[10px] text-green-500 font-bold flex items-center gap-1"><span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> AKTIF SEKARANG</p>
                        </div>
                    </div>
                    <div class="flex-1 bg-slate-50/50 p-6 overflow-y-auto space-y-6 no-scrollbar" id="chat-container">
                        <template x-for="msg in chatMessages" :key="msg.id">
                            <div :class="msg.sender === 'bot' ? 'flex justify-start' : 'flex justify-end'">
                                <div :class="msg.sender === 'bot' ? 'bg-white border border-slate-100 text-slate-700 rounded-tl-none' : 'bg-slate-900 text-white rounded-tr-none'" 
                                     class="p-4 rounded-3xl shadow-sm max-w-[85%] text-sm leading-relaxed">
                                    <p x-html="msg.text"></p>
                                    <p class="text-[9px] mt-2 opacity-50 font-bold uppercase text-right" x-text="msg.time"></p>
                                </div>
                            </div>
                        </template>
                        <div x-show="isTyping" class="flex justify-start">
                            <div class="bg-white border border-slate-100 p-4 rounded-3xl rounded-tl-none animate-pulse text-[10px] text-slate-400 font-bold tracking-widest">MENGETIK...</div>
                        </div>
                    </div>
                    <div class="p-6 bg-white border-t border-slate-100">
                        <form @submit.prevent="sendMessage" class="flex gap-3">
                            <input type="text" x-model="chatInput" placeholder="Tanya sesuatu tentang daur ulang..." class="flex-1 bg-slate-100 rounded-2xl px-5 py-4 text-sm outline-none focus:ring-2 focus:ring-emerald-500 transition">
                            <button type="submit" :disabled="!chatInput" class="bg-slate-900 text-white w-14 h-14 rounded-2xl flex items-center justify-center shadow-xl hover:bg-emerald-600 transition disabled:opacity-50"><i class="ph-bold ph-paper-plane-right text-xl"></i></button>
                        </form>
                    </div>
                </div>

                <!-- === MARKET VIEW === -->
                <div x-show="currentPage === 'market'" x-transition class="max-w-6xl mx-auto animate-slide-up">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800 tracking-tight">Eco Market</h2>
                            <p class="text-sm text-slate-500 font-medium">Tukar poin atau beli produk ramah lingkungan.</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <template x-for="item in marketItems" :key="item.id">
                            <div class="bg-white p-5 rounded-[2.5rem] border border-slate-200 shadow-sm flex flex-col h-full hover:shadow-2xl hover:-translate-y-1 transition duration-300">
                                <div :class="item.bgClass" class="h-40 rounded-[2rem] mb-4 flex items-center justify-center text-5xl shadow-inner relative overflow-hidden">
                                    <i :class="item.icon"></i>
                                    <div x-show="item.type === 'money'" class="absolute top-3 right-3 bg-white/50 backdrop-blur-sm px-2 py-1 rounded-lg text-[10px] font-bold uppercase tracking-widest text-slate-600 border border-white/20">Beli</div>
                                </div>
                                <div class="flex-1 px-2">
                                    <h4 class="font-bold text-lg text-slate-800 leading-tight" x-text="item.name"></h4>
                                    <p class="text-xs text-slate-500 mt-1 mb-4 leading-relaxed" x-text="item.desc"></p>
                                </div>
                                <div class="flex justify-between items-center pt-4 border-t border-slate-50 px-1">
                                    <span class="font-black text-slate-800 text-sm" x-text="item.cost"></span>
                                    <button @click="startTransaction(item)" class="bg-slate-900 text-white px-5 py-2 rounded-xl text-xs font-bold hover:bg-emerald-600 transition active:scale-95 shadow-lg shadow-slate-200">
                                        <span x-text="item.type === 'xp' ? 'Tukar' : 'Beli'"></span>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- === CALCULATOR VIEW (IMPROVED) === -->
                <div x-show="currentPage === 'calc'" x-transition class="max-w-3xl mx-auto animate-slide-up">
                    <div class="text-center mb-10">
                        <div class="w-20 h-20 bg-emerald-100 rounded-3xl mx-auto flex items-center justify-center text-emerald-600 text-4xl mb-4 shadow-sm">
                            <i class="ph-duotone ph-calculator"></i>
                        </div>
                        <h2 class="text-3xl font-black text-slate-900 tracking-tight">Kalkulator Jejak Karbon</h2>
                        <p class="text-slate-500 mt-2 font-medium">Berapa besar dampak sampahmu terhadap pemanasan global?</p>
                    </div>

                    <div class="bg-white rounded-[2.5rem] shadow-xl border border-slate-200 overflow-hidden">
                        <!-- Input Section -->
                        <div class="p-8 md:p-10 border-b border-slate-100 bg-slate-50/50">
                            <h3 class="font-bold text-lg text-slate-800 mb-6 flex items-center gap-2">
                                <i class="ph-fill ph-sliders-horizontal text-emerald-500"></i> Estimasi Sampah Mingguan (Kg)
                            </h3>
                            
                            <div class="grid md:grid-cols-2 gap-8">
                                <!-- Plastik -->
                                <div>
                                    <div class="flex justify-between mb-2 text-sm font-bold">
                                        <span class="text-slate-600 flex items-center gap-2"><i class="ph-fill ph-bottle text-blue-400"></i> Plastik</span>
                                        <span class="text-emerald-600" x-text="carbonCalc.plastic + ' kg'"></span>
                                    </div>
                                    <input type="range" min="0" max="10" step="0.1" x-model="carbonCalc.plastic" class="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-500 hover:accent-emerald-400 transition">
                                </div>

                                <!-- Kertas -->
                                <div>
                                    <div class="flex justify-between mb-2 text-sm font-bold">
                                        <span class="text-slate-600 flex items-center gap-2"><i class="ph-fill ph-newspaper text-amber-400"></i> Kertas/Kardus</span>
                                        <span class="text-emerald-600" x-text="carbonCalc.paper + ' kg'"></span>
                                    </div>
                                    <input type="range" min="0" max="10" step="0.1" x-model="carbonCalc.paper" class="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-500 hover:accent-amber-400 transition">
                                </div>

                                <!-- Kaca -->
                                <div>
                                    <div class="flex justify-between mb-2 text-sm font-bold">
                                        <span class="text-slate-600 flex items-center gap-2"><i class="ph-fill ph-wine text-teal-400"></i> Kaca/Beling</span>
                                        <span class="text-emerald-600" x-text="carbonCalc.glass + ' kg'"></span>
                                    </div>
                                    <input type="range" min="0" max="10" step="0.1" x-model="carbonCalc.glass" class="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-teal-500 hover:accent-teal-400 transition">
                                </div>

                                <!-- Logam -->
                                <div>
                                    <div class="flex justify-between mb-2 text-sm font-bold">
                                        <span class="text-slate-600 flex items-center gap-2"><i class="ph-fill ph-tin-can text-slate-400"></i> Logam/Kaleng</span>
                                        <span class="text-emerald-600" x-text="carbonCalc.metal + ' kg'"></span>
                                    </div>
                                    <input type="range" min="0" max="50" step="0.1" x-model="carbonCalc.metal" class="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-500 hover:accent-slate-400 transition">
                                </div>
                            </div>
                        </div>

                        <!-- Result Section -->
                        <div class="p-8 md:p-10 bg-slate-900 text-white relative overflow-hidden group">
                            <!-- Background Decoration -->
                            <div class="absolute -right-20 -top-20 w-64 h-64 bg-emerald-500 rounded-full blur-[80px] opacity-20 group-hover:opacity-30 transition duration-1000"></div>
                            
                            <div class="grid md:grid-cols-2 gap-10 relative z-10 items-center">
                                <div>
                                    <p class="text-slate-400 text-xs font-bold uppercase tracking-[0.2em] mb-2">Total Jejak Karbon</p>
                                    <div class="flex items-end gap-2 mb-1">
                                        <span class="text-6xl font-black text-white tracking-tighter" x-text="weeklyEmission"></span>
                                        <span class="text-xl font-bold text-emerald-400 mb-2">kg CO2e</span>
                                    </div>
                                    <p class="text-sm text-slate-400">Estimasi emisi per minggu dari sampah yang tidak terolah.</p>
                                </div>

                                <div class="bg-white/10 backdrop-blur-md p-6 rounded-2xl border border-white/10">
                                    <div class="flex items-start gap-4">
                                        <div class="w-12 h-12 bg-emerald-500 rounded-xl flex items-center justify-center text-white text-2xl shrink-0 shadow-lg">
                                            <i class="ph-fill ph-tree"></i>
                                        </div>
                                        <div>
                                            <p class="text-xs font-bold text-emerald-300 uppercase tracking-wide mb-1">Kompensasi Alam</p>
                                            <p class="text-sm leading-relaxed text-slate-200">
                                                Kamu butuh menanam sekitar <b class="text-white text-lg mx-1" x-text="treesNeeded"></b> pohon setahun untuk menyerap emisi ini.
                                            </p>
                                        </div>
                                    </div>
                                    <button class="mt-4 w-full bg-white text-slate-900 py-2.5 rounded-xl text-xs font-bold hover:bg-emerald-50 transition active:scale-95 flex items-center justify-center gap-2">
                                        <i class="ph-bold ph-share-network"></i> Bagikan Hasil Ini
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Info Cards -->
                    <div class="grid md:grid-cols-3 gap-6 mt-8">
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center text-center">
                            <i class="ph-duotone ph-recycle text-3xl text-blue-500 mb-2"></i>
                            <h4 class="font-bold text-slate-800 text-sm">Daur Ulang</h4>
                            <p class="text-[10px] text-slate-500 mt-1">Menghemat hingga 90% energi produksi baru.</p>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center text-center">
                            <i class="ph-duotone ph-plant text-3xl text-green-500 mb-2"></i>
                            <h4 class="font-bold text-slate-800 text-sm">Komposting</h4>
                            <p class="text-[10px] text-slate-500 mt-1">Mengurangi gas metana di TPA secara drastis.</p>
                        </div>
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center text-center">
                            <i class="ph-duotone ph-trash text-3xl text-red-500 mb-2"></i>
                            <h4 class="font-bold text-slate-800 text-sm">Kurangi Sampah</h4>
                            <p class="text-[10px] text-slate-500 mt-1">Solusi terbaik adalah mencegah sampah itu ada.</p>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- === MODAL PEMBAYARAN === -->
    <div x-show="showPaymentModal" class="fixed inset-0 z-50 flex items-center justify-center px-4" style="display: none;">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" @click="closePayment()"></div>
        
        <!-- Modal Content -->
        <div class="bg-white w-full max-w-sm rounded-[2rem] shadow-2xl relative z-10 overflow-hidden transform transition-all p-6 text-center">
            
            <!-- Step 1: Detail -->
            <div x-show="paymentStep === 1">
                <div class="w-16 h-16 bg-slate-100 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl">
                    <i class="ph-duotone ph-shopping-cart text-slate-600"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-900 mb-1">Konfirmasi Pembelian</h3>
                <p class="text-sm text-slate-500 mb-6" x-text="selectedItem?.name"></p>
                <div class="bg-slate-50 p-4 rounded-xl mb-6">
                    <p class="text-xs text-slate-400 uppercase font-bold tracking-wider mb-1">Total Bayar</p>
                    <p class="text-2xl font-black text-slate-800" x-text="selectedItem?.cost"></p>
                </div>
                <button @click="processPayment()" class="w-full bg-emerald-600 text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-emerald-700 transition">Bayar Sekarang</button>
                <button @click="closePayment()" class="w-full text-slate-400 font-bold text-sm mt-4 hover:text-slate-600">Batal</button>
            </div>

            <!-- Step 2: QRIS Loading -->
            <div x-show="paymentStep === 2" class="py-10">
                <div class="w-48 h-48 mx-auto bg-white border-2 border-slate-900 rounded-xl p-2 relative mb-4">
                    <!-- Fake QR Code -->
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=SORTIQ_PAYMENT_DEMO" class="w-full h-full opacity-50 blur-sm">
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="w-12 h-12 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"></div>
                    </div>
                </div>
                <p class="font-bold text-slate-800 animate-pulse">Memproses Pembayaran...</p>
            </div>

            <!-- Step 3: Success -->
            <div x-show="paymentStep === 3">
                <div class="w-20 h-20 bg-emerald-100 rounded-full mx-auto mb-4 flex items-center justify-center text-4xl text-emerald-600">
                    <i class="ph-fill ph-check-circle"></i>
                </div>
                <h3 class="text-xl font-bold text-emerald-700 mb-2">Pembayaran Berhasil!</h3>
                <p class="text-sm text-slate-500 mb-6">Terima kasih telah mendukung produk ramah lingkungan.</p>
                <button @click="closePayment()" class="w-full bg-slate-900 text-white py-3.5 rounded-xl font-bold shadow-lg">Tutup</button>
            </div>
        </div>
    </div>

    <!-- === MOBILE NAVIGATION BAR === -->
    <div class="md:hidden fixed bottom-8 left-6 right-6 bg-slate-900/90 backdrop-blur-xl rounded-[2rem] p-3 flex justify-between items-center shadow-2xl z-50 border border-white/10">
        <button @click="setPage('home')" :class="currentPage === 'home' ? 'text-white bg-white/10' : 'text-slate-500'" class="w-12 h-12 flex items-center justify-center rounded-2xl"><i class="ph-bold ph-squares-four text-2xl"></i></button>
        <button @click="setPage('tpa')" :class="currentPage === 'tpa' ? 'text-white bg-white/10' : 'text-slate-500'" class="w-12 h-12 flex items-center justify-center rounded-2xl"><i class="ph-bold ph-map-trifold text-2xl"></i></button>
        <div class="relative -top-10">
            <button onclick="window.location.href='scan.html'" class="w-16 h-16 bg-gradient-to-tr from-emerald-500 to-emerald-400 rounded-full flex items-center justify-center text-white shadow-xl shadow-emerald-500/40 border-[6px] border-slate-50 transition active:scale-90"><i class="ph-bold ph-scan text-2xl"></i></button>
        </div>
        <button @click="setPage('market')" :class="currentPage === 'market' ? 'text-white bg-white/10' : 'text-slate-500'" class="w-12 h-12 flex items-center justify-center rounded-2xl"><i class="ph-bold ph-storefront text-2xl"></i></button>
        <button @click="setPage('bot')" :class="currentPage === 'bot' ? 'text-white bg-white/10' : 'text-slate-500'" class="w-12 h-12 flex items-center justify-center rounded-2xl"><i class="ph-bold ph-chat-centered-text text-2xl"></i></button>
    </div>

    <!-- === TOAST NOTIFICATION === -->
    <div x-show="toast.show" x-transition class="fixed top-8 left-1/2 -translate-x-1/2 z-[100] bg-slate-900 text-white px-8 py-4 rounded-3xl shadow-2xl flex items-center gap-4 border border-white/10">
        <div class="w-10 h-10 bg-emerald-500/20 rounded-xl flex items-center justify-center text-emerald-400"><i class="ph-fill ph-check-circle text-2xl"></i></div>
        <div>
            <p class="font-bold text-sm tracking-tight" x-text="toast.title"></p>
            <p class="text-[11px] text-slate-400 font-medium" x-text="toast.message"></p>
        </div>
    </div>

</body>
</html>